FROM amazoncorretto:11-alpine as corretto-jdk

RUN apk add --no-cache binutils

RUN jlink \
--add-modules ALL-MODULE-PATH \
--strip-debug \
--no-man-pages \
--no-header-files \
--compress=2 \
--output /jre

FROM xiaoyaliu/alist:latest

LABEL MAINTAINER="Har01d"

ENV JAVA_HOME=/jre
ENV PATH="${JAVA_HOME}/bin:${PATH}"

COPY --from=corretto-jdk /jre $JAVA_HOME

VOLUME /opt/atv/data/

WORKDIR /opt/atv/

COPY docker-entrypoint.sh /entrypoint.sh

COPY target/alist-tvbox-1.0.jar ./alist-tvbox.jar

COPY config/nginx.conf /var/lib/nginx.conf

EXPOSE 8080
EXPOSE 80

ENTRYPOINT ["/entrypoint.sh"]
